<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><pre><a name="1"></a>#<font color="red">include </font>"blah.h"
<a name="2"></a>
<a name="3"></a><font color="blue">int </font>foo() {
<a name="4"></a>    // Notice how there's a 4:7 ratio of asm to source lines here - this ratio
<a name="5"></a>    // can be aribtrary
<a name="6"></a>    <font color="blue">int </font>x = 0;
<a name="7"></a>    <font color="red">for </font>(<font color="blue">int </font>i = 0; i < 100; ++i) {
<a name="8"></a>        x += i;
<a name="9"></a>    }
<a name="10"></a>    printf("%d\n", x);
<a name="11"></a>    <font color="red">return </font>x;
<a name="12"></a>}
<a name="13"></a>
<a name="14"></a>static void NO_INLINE bar() {
<a name="15"></a>    // This is just to make sure this function doesn't get optimized out
<a name="16"></a>    asm("");
<a name="17"></a>}
<a name="18"></a>
<a name="19"></a>void NO_INLINE complicated_func() {
<a name="20"></a>    <font color="blue">int </font>x;
<a name="21"></a>    scanf("%d\n", &x);
<a name="22"></a>    volatile <font color="blue">int </font>y = x;
<a name="23"></a>
<a name="24"></a>    do {
<a name="25"></a>        <font color="red">for </font>(<font color="blue">int </font>i = 0; i < 2; ++i) {
<a name="26"></a>            y += i;
<a name="27"></a>            printf("%d\n", y);
<a name="28"></a>        }
<a name="29"></a>    } <font color="red">while </font>(y == 7);
<a name="30"></a>
<a name="31"></a>    printf("%d\n", y);
<a name="32"></a>}
<a name="33"></a>
<a name="34"></a><font color="blue">int </font>main() {
<a name="35"></a>    // which bar?
<a name="36"></a>    bar();
<a name="37"></a>    complicated_func();
<a name="38"></a>    // Notice that the source before this comes from a different file
<a name="39"></a>    blah();
<a name="40"></a>    <font color="red">return </font>0;
<a name="41"></a>}
<a name="42"></a><a name="42"></a>#<font color="red">include </font>&lt;stdio.h&gt;
<a name="43"></a>#define NO_INLINE __attribute__((noinline))
<a name="44"></a>
<a name="45"></a>inline <font color="blue">int </font>blah() {
<a name="46"></a>    <font color="blue">int </font>x;
<a name="47"></a>    scanf("%d", &x);
<a name="48"></a>    <font color="red">return </font>x;
<a name="49"></a>}
<a name="50"></a><a name="50"></a>#<font color="red">include </font>"blah.h"
<a name="51"></a>
<a name="52"></a><font color="blue">int </font>foo() {
<a name="53"></a>    // Notice how there's a 4:7 ratio of asm to source lines here - this ratio
<a name="54"></a>    // can be aribtrary
<a name="55"></a>    <font color="blue">int </font>x = 0;
<a name="56"></a>    <font color="red">for </font>(<font color="blue">int </font>i = 0; i < 100; ++i) {
<a name="57"></a>        x += i;
<a name="58"></a>    }
<a name="59"></a>    printf("%d\n", x);
<a name="60"></a>    <font color="red">return </font>x;
<a name="61"></a>}
<a name="62"></a>
<a name="63"></a>static void NO_INLINE bar() {
<a name="64"></a>    // This is just to make sure this function doesn't get optimized out
<a name="65"></a>    asm("");
<a name="66"></a>}
<a name="67"></a>
<a name="68"></a>void NO_INLINE complicated_func() {
<a name="69"></a>    <font color="blue">int </font>x;
<a name="70"></a>    scanf("%d\n", &x);
<a name="71"></a>    volatile <font color="blue">int </font>y = x;
<a name="72"></a>
<a name="73"></a>    do {
<a name="74"></a>        <font color="red">for </font>(<font color="blue">int </font>i = 0; i < 2; ++i) {
<a name="75"></a>            y += i;
<a name="76"></a>            printf("%d\n", y);
<a name="77"></a>        }
<a name="78"></a>    } <font color="red">while </font>(y == 7);
<a name="79"></a>
<a name="80"></a>    printf("%d\n", y);
<a name="81"></a>}
<a name="82"></a>
<a name="83"></a><font color="blue">int </font>main() {
<a name="84"></a>    // which bar?
<a name="85"></a>    bar();
<a name="86"></a>    complicated_func();
<a name="87"></a>    // Notice that the source before this comes from a different file
<a name="88"></a>    blah();
<a name="89"></a>    <font color="red">return </font>0;
<a name="90"></a>}
<a name="91"></a><a name="91"></a>#<font color="red">include </font>"blah.h"
<a name="92"></a>
<a name="93"></a>static void NO_INLINE bar() {
<a name="94"></a>    asm("");
<a name="95"></a>}
<a name="96"></a>
<a name="97"></a>void func() {
<a name="98"></a>    // which bar?
<a name="99"></a>    bar();
<a name="100"></a>}
<a name="101"></a></pre></body></html>